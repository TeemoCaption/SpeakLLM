# 資料清理與對齊流程

## 音訊取樣與重採樣
- **ASR 鏈**：維持 16 kHz，對應 `Whisper Medium`。原始高取樣率（如 44.1 kHz）需以 `sox` 或 `torchaudio` 重採樣。
- **TTS 鏈**：統一為 24 kHz，供 `CosyVoice2` 使用；同步保留 16 kHz 備份以利交叉驗證。

## 文字正規化與標註
- **繁簡統一**：採用 OpenCC，並維護繁簡詞表以便需求切換。
- **語氣詞保留**：維持「嗯」「啊」「喔」等口語，避免過度清洗。
- **音節與語調標註**：使用 `g2pC` 生成拼音+聲調；對於 tone sandhi 可使用規則修正或 SER 模型預測。
- **語言標記**：中英混碼場景插入 `lang_zh`、`lang_en` token，粵語可使用 `lang_yue`。

## 段落切分與 VAD
- **工具**：`webrtcvad`，閾值 2，最短片段 200 ms。
- **長句拆分**：對超過 5–8 秒句子進行等長切片，保留重疊資訊以便 Overlap Loss。
- **對話場景**：在 `MagicData-RAMC`、`RealTalk-CN` 等資料上保留重疊標記與說話人角色。

## 噪聲與增強
- **資料集**：`MUSAN`（噪聲/音樂）與 `RIRS_NOISES`（房間脈衝響應）。
- **增強手段**：加噪、混響、速度擾動（0.9–1.1x）。需保留乾淨驗證集以評估原生音質。

## 音節級對齊
1. `Whisper Medium` 產生初始轉寫與時間戳。
2. 利用 `g2pC` 音節序列與原始時間戳進行 `DTW` 對齊；必要時使用 `MFA` 強制對齊。
3. 產出音節級對齊檔（JSON 或 TSV），包含時間區間、tone、語氣詞標記。

## 重疊語音標註
- **自動標註**：以能量閾值 + 語音分離模型偵測重疊區。
- **語義衝突檢測**：利用簡易語義分類器判斷使用者意圖，標記輸出回答是否衝突。
- **人工驗證**：抽樣覆核，確保關鍵場景（搶話、澄清）標註準確。

## 混碼採樣與比例控制
- 維持 zh:en ≈ 7:3，zh-TW 佔中文 15–25%，粵語 10–15%。
- 使用 stratified sampling 建立訓練/驗證/測試集，保證語種與方言分布一致。

## 數據版本化
- 使用 `DVC` 或 `git-lfs` 管理大檔案。
- 建立 `metadata.json` 記錄來源、授權、增強策略、標註版本。

## 驗證與稽核
- 定期抽樣檢查音質（DNSMOS）與轉寫 CER。
- 建立自動報表：混碼比例、tone 分布、語氣詞保留率、重疊片段覆蓋率。
